
@{
    ViewBag.Title = "Chat";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    .users {
        margin-top: 40px;
        width: 500px;
    }

        .users table {
            text-align: center;
        }

    .usersBar ul .newUser {
        background: green;
    }
</style>
<div class="row">
    <div class="col-lg-12">

    </div>
    <div class="usersBar">
        <ul>
            <li>Contacts</li>
        </ul>
    </div>
</div>
@section scripts{
    <script src="~/Scripts/jquery.signalR-2.4.2.min.js" type="text/javascript"></script>
    <script src="~/signalR/js" type="text/javascript"></script>
    <script src="~/Scripts/ChatApi.js" type="text/javascript"></script>
    <script>
        var userId = @Session["Id"]
        $.connection.hub.start()
            .done(function () {
                chatApi.Users();
                $.connection.usersHub.server.userLogin(userId);
            })
            .fail(function () { alert("failed to connect"); });

        $.connection.usersHub.client.newUser = function (data) {
            $(".usersBar ul").append("<li class='newUser' id='" + data["Id"] + "'>" + data["Name"] + "</li>");
            setTimeout(function () {
                $(".usersBar ul li").removeAttr("class");
            }, 3000);
        }
        $.connection.usersHub.client.connectedUser = function (id) {
            $("#" + id).css({"background":"lightgreen"});
        }
    </script>
}